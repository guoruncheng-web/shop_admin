# å“ç‰Œç®¡ç†æ¨¡å— (Brand Management Module)

## æ¦‚è¿°

å“ç‰Œç®¡ç†æ¨¡å—å®ç°äº†å¤šç§Ÿæˆ·ç”µå•†ç³»ç»Ÿä¸­çš„å“ç‰Œç®¡ç†åŠŸèƒ½ï¼Œæ”¯æŒå“ç‰Œçš„åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ä»¥åŠæ‰¹é‡æ“ä½œã€‚æ¯ä¸ªå•†æˆ·å¯ä»¥åˆ›å»ºå¤šä¸ªå“ç‰Œï¼Œå“ç‰Œéœ€è¦ç»è¿‡è®¤è¯åæ‰èƒ½åœ¨å®¢æˆ·ç«¯åº”ç”¨ä¸­æ˜¾ç¤ºã€‚

## åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… å“ç‰Œåˆ›å»ºä¸ç®¡ç†
- âœ… å“ç‰Œè®¤è¯çŠ¶æ€ç®¡ç†
- âœ… å“ç‰Œçƒ­é—¨çŠ¶æ€ç®¡ç†
- âœ… å“ç‰Œæ ‡ç­¾ç³»ç»Ÿ
- âœ… æ‰¹é‡æ“ä½œæ”¯æŒ
- âœ… åˆ†é¡µæŸ¥è¯¢ä¸æœç´¢
- âœ… å“ç‰Œç»Ÿè®¡åˆ†æ

### å¤šç§Ÿæˆ·æ”¯æŒ
- ğŸ¢ å•†æˆ·éš”ç¦»ï¼šæ¯ä¸ªå•†æˆ·åªèƒ½ç®¡ç†è‡ªå·±çš„å“ç‰Œ
- ğŸ”’ æƒé™æ§åˆ¶ï¼šåŸºäºè§’è‰²çš„ç»†ç²’åº¦æƒé™ç®¡ç†
- ğŸ“Š æ•°æ®éš”ç¦»ï¼šç¡®ä¿è·¨å•†æˆ·æ•°æ®å®‰å…¨

### ä¸šåŠ¡è§„åˆ™
- ğŸ·ï¸ å“ç‰Œåç§°åœ¨å•†æˆ·èŒƒå›´å†…å¿…é¡»å”¯ä¸€
- ğŸ“‹ å“ç‰Œæ›´æ–°åéœ€è¦é‡æ–°è®¤è¯
- ğŸ”¥ æ”¯æŒçƒ­é—¨å“ç‰Œæ ‡è¯†
- ğŸ·ï¸ çµæ´»çš„æ ‡ç­¾ç³»ç»Ÿæ”¯æŒä¸šåŠ¡æ‰©å±•

## æ•°æ®åº“ç»“æ„

### å“ç‰Œè¡¨ (brands)

| å­—æ®µå | ç±»å‹ | è¯´æ˜ | çº¦æŸ |
|--------|------|------|------|
| id | INT | ä¸»é”®ID | AUTO_INCREMENT, PRIMARY KEY |
| merchantId | INT | å•†æˆ·ID | FOREIGN KEY, NOT NULL |
| name | VARCHAR(255) | å“ç‰Œåç§° | UNIQUE(merchantId, name), NOT NULL |
| iconUrl | TEXT | å“ç‰Œå›¾æ ‡URL | NOT NULL |
| creator | INT | åˆ›å»ºè€…ID | FOREIGN KEY, NOT NULL |
| createTime | DATETIME | åˆ›å»ºæ—¶é—´ | DEFAULT CURRENT_TIMESTAMP |
| updateTime | DATETIME | æ›´æ–°æ—¶é—´ | DEFAULT CURRENT_TIMESTAMP ON UPDATE |
| status | TINYINT | çŠ¶æ€ | DEFAULT 1 (0-ç¦ç”¨, 1-å¯ç”¨) |
| isAuth | TINYINT | è®¤è¯çŠ¶æ€ | DEFAULT 0 (0-æœªè®¤è¯, 1-å·²è®¤è¯) |
| isHot | TINYINT | çƒ­é—¨çŠ¶æ€ | DEFAULT 0 (0-æ™®é€š, 1-çƒ­é—¨) |
| label | JSON | æ ‡ç­¾æ•°ç»„ | DEFAULT NULL |

### ç´¢å¼•è®¾è®¡
- PRIMARY KEY (`id`)
- UNIQUE KEY `uniq_merchant_brand` (`merchantId`, `name`)
- INDEX `idx_merchant_status` (`merchantId`, `status`)
- INDEX `idx_merchant_auth` (`merchantId`, `isAuth`)
- INDEX `idx_merchant_hot` (`merchantId`, `isHot`)
- INDEX `idx_creator` (`creator`)

## API æ¥å£

### åŸºç¡€ CRUD æ“ä½œ

#### 1. è·å–å“ç‰Œåˆ—è¡¨ (åˆ†é¡µ)
```
GET /brands
```
**æƒé™æ ‡è¯†**: `system:brands:view`

**æŸ¥è¯¢å‚æ•°**:
- `page` (number): é¡µç ï¼Œé»˜è®¤ 1
- `limit` (number): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤ 10
- `name` (string): å“ç‰Œåç§°æ¨¡ç³Šæœç´¢
- `status` (number): çŠ¶æ€è¿‡æ»¤ (0-ç¦ç”¨, 1-å¯ç”¨)
- `isAuth` (number): è®¤è¯çŠ¶æ€è¿‡æ»¤ (0-æœªè®¤è¯, 1-å·²è®¤è¯)
- `isHot` (number): çƒ­é—¨çŠ¶æ€è¿‡æ»¤ (0-æ™®é€š, 1-çƒ­é—¨)
- `label` (string): æ ‡ç­¾è¿‡æ»¤

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "items": [...],
    "meta": {
      "total": 100,
      "page": 1,
      "limit": 10,
      "totalPages": 10
    }
  }
}
```

#### 2. è·å–æ‰€æœ‰å“ç‰Œ (ä¸åˆ†é¡µ)
```
GET /brands/all
```
**æƒé™æ ‡è¯†**: `system:brands:viewAll`

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": [
    {
      "id": 1,
      "name": "è‹¹æœ",
      "iconUrl": "https://...",
      "status": 1,
      "isAuth": 1,
      "isHot": 1,
      "label": ["premium", "popular"]
    }
  ]
}
```

#### 3. è·å–å“ç‰Œè¯¦æƒ…
```
GET /brands/:id
```
**æƒé™æ ‡è¯†**: `system:brands:detail`

#### 4. åˆ›å»ºå“ç‰Œ
```
POST /brands
```
**æƒé™æ ‡è¯†**: `system:brands:add`

**è¯·æ±‚ä½“**:
```json
{
  "name": "æ–°å“ç‰Œ",
  "iconUrl": "https://example.com/icon.png",
  "label": ["new", "featured"]
}
```

#### 5. æ›´æ–°å“ç‰Œ
```
PUT /brands/:id
```
**æƒé™æ ‡è¯†**: `system:brands:edit`

**è¯·æ±‚ä½“**:
```json
{
  "name": "æ›´æ–°åçš„å“ç‰Œå",
  "iconUrl": "https://example.com/new-icon.png",
  "label": ["updated", "featured"]
}
```

#### 6. åˆ é™¤å“ç‰Œ
```
DELETE /brands/:id
```
**æƒé™æ ‡è¯†**: `system:brands:delete`

### æ‰¹é‡æ“ä½œ

#### 7. æ‰¹é‡æ›´æ–°çŠ¶æ€
```
PUT /brands/batch/status
```
**æƒé™æ ‡è¯†**: `system:brands:batchStatus`

**è¯·æ±‚ä½“**:
```json
{
  "ids": [1, 2, 3],
  "status": 1
}
```

#### 8. æ‰¹é‡æ›´æ–°è®¤è¯çŠ¶æ€
```
PUT /brands/batch/auth
```
**æƒé™æ ‡è¯†**: `system:brands:batchAuth`

**è¯·æ±‚ä½“**:
```json
{
  "ids": [1, 2, 3],
  "isAuth": 1
}
```

### ç»Ÿè®¡åˆ†æ

#### 9. è·å–å“ç‰Œç»Ÿè®¡
```
GET /brands/statistics
```
**æƒé™æ ‡è¯†**: `system:brands:statistics`

**å“åº”ç¤ºä¾‹**:
```json
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "total": 100,
    "enabled": 80,
    "disabled": 20,
    "authenticated": 60,
    "unauthenticated": 40,
    "hot": 10,
    "normal": 90
  }
}
```

## æƒé™æ ‡è¯†è¯´æ˜

| æƒé™æ ‡è¯† | è¯´æ˜ | æ“ä½œ |
|----------|------|------|
| `system:brands:view` | æŸ¥çœ‹å“ç‰Œåˆ—è¡¨ | åˆ†é¡µæŸ¥è¯¢ã€æœç´¢ |
| `system:brands:viewAll` | æŸ¥çœ‹æ‰€æœ‰å“ç‰Œ | è·å–æ‰€æœ‰å“ç‰Œï¼ˆä¸åˆ†é¡µï¼‰ |
| `system:brands:detail` | æŸ¥çœ‹å“ç‰Œè¯¦æƒ… | è·å–å•ä¸ªå“ç‰Œä¿¡æ¯ |
| `system:brands:add` | åˆ›å»ºå“ç‰Œ | æ–°å¢å“ç‰Œ |
| `system:brands:edit` | ç¼–è¾‘å“ç‰Œ | æ›´æ–°å“ç‰Œä¿¡æ¯ |
| `system:brands:delete` | åˆ é™¤å“ç‰Œ | åˆ é™¤å“ç‰Œ |
| `system:brands:batchStatus` | æ‰¹é‡æ›´æ–°çŠ¶æ€ | æ‰¹é‡å¯ç”¨/ç¦ç”¨ |
| `system:brands:batchAuth` | æ‰¹é‡è®¤è¯ | æ‰¹é‡è®¤è¯æ“ä½œ |
| `system:brands:statistics` | æŸ¥çœ‹ç»Ÿè®¡ | å“ç‰Œç»Ÿè®¡åˆ†æ |

## ä¸šåŠ¡é€»è¾‘

### å“ç‰Œåˆ›å»º
1. éªŒè¯å“ç‰Œåç§°åœ¨å•†æˆ·èŒƒå›´å†…çš„å”¯ä¸€æ€§
2. è‡ªåŠ¨è®¾ç½®åˆ›å»ºè€…ä¸ºå½“å‰ç™»å½•ç”¨æˆ·
3. è‡ªåŠ¨è®¾ç½®åˆ›å»ºæ—¶é—´å’Œæ›´æ–°æ—¶é—´
4. é»˜è®¤çŠ¶æ€ä¸ºå¯ç”¨ï¼Œè®¤è¯çŠ¶æ€ä¸ºæœªè®¤è¯
5. è®°å½•æ“ä½œæ—¥å¿—

### å“ç‰Œæ›´æ–°
1. éªŒè¯å“ç‰Œå±äºå½“å‰å•†æˆ·
2. æ›´æ–°æ—¶è‡ªåŠ¨é‡ç½®è®¤è¯çŠ¶æ€ä¸ºæœªè®¤è¯
3. è‡ªåŠ¨æ›´æ–°æ›´æ–°æ—¶é—´
4. è®°å½•æ“ä½œæ—¥å¿—

### å“ç‰Œåˆ é™¤
1. éªŒè¯å“ç‰Œå±äºå½“å‰å•†æˆ·
2. **æ£€æŸ¥å“ç‰Œæ˜¯å¦è¢«å•†å“å¼•ç”¨**ï¼ˆå¤–é”®çº¦æŸæ£€æŸ¥ï¼‰
   - æŸ¥è¯¢ `products` è¡¨ä¸­æ˜¯å¦æœ‰å•†å“ä½¿ç”¨è¯¥å“ç‰Œ
   - å¦‚æœå­˜åœ¨å…³è”å•†å“ï¼Œè¿”å› 400 é”™è¯¯å¹¶æç¤ºå•†å“æ•°é‡
   - å¿…é¡»å…ˆåˆ é™¤æˆ–è½¬ç§»å…³è”å•†å“æ‰èƒ½åˆ é™¤å“ç‰Œ
3. ç‰©ç†åˆ é™¤å“ç‰Œè®°å½•
4. è®°å½•æ“ä½œæ—¥å¿—

**åˆ é™¤å¤±è´¥ç¤ºä¾‹**ï¼š
```json
{
  "code": 400,
  "message": "è¯¥å“ç‰Œä¸‹è¿˜æœ‰ 5 ä¸ªå•†å“ï¼Œæ— æ³•åˆ é™¤ã€‚è¯·å…ˆåˆ é™¤æˆ–è½¬ç§»è¿™äº›å•†å“ã€‚"
}
```

### æ‰¹é‡æ“ä½œ
1. éªŒè¯æ‰€æœ‰å“ç‰ŒIDéƒ½å±äºå½“å‰å•†æˆ·
2. æ‰¹é‡æ›´æ–°çŠ¶æ€æˆ–è®¤è¯çŠ¶æ€
3. è®°å½•æ‰¹é‡æ“ä½œæ—¥å¿—

## é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯ç 

| é”™è¯¯ç  | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|--------|------|----------|
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ | æ£€æŸ¥è¯·æ±‚å‚æ•°æ ¼å¼å’Œå¿…å¡«å­—æ®µ |
| 401 | æœªæˆæƒ | æ£€æŸ¥ç™»å½•çŠ¶æ€å’ŒTokenæœ‰æ•ˆæ€§ |
| 403 | æƒé™ä¸è¶³ | æ£€æŸ¥ç”¨æˆ·æƒé™é…ç½® |
| 404 | èµ„æºä¸å­˜åœ¨ | ç¡®è®¤å“ç‰ŒIDæ˜¯å¦æ­£ç¡® |
| 409 | åç§°é‡å¤ | æ›´æ¢å“ç‰Œåç§°åé‡è¯• |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿— |

### é”™è¯¯å“åº”æ ¼å¼
```json
{
  "code": 400,
  "message": "å“ç‰Œåç§°å·²å­˜åœ¨",
  "data": null,
  "timestamp": "2024-01-01T00:00:00.000Z"
}
```

## ä½¿ç”¨ç¤ºä¾‹

### åˆ›å»ºå“ç‰Œ
```javascript
// è¯·æ±‚
POST /api/brands
Authorization: Bearer <token>
Content-Type: application/json

{
  "name": "å°ç±³",
  "iconUrl": "https://example.com/mi-logo.png",
  "label": ["chinese", "tech"]
}

// å“åº”
{
  "code": 200,
  "message": "å“ç‰Œåˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 1,
    "name": "å°ç±³",
    "iconUrl": "https://example.com/mi-logo.png",
    "status": 1,
    "isAuth": 0,
    "isHot": 0,
    "label": ["chinese", "tech"],
    "merchantId": 1,
    "creator": 1,
    "createTime": "2024-01-01T00:00:00.000Z",
    "updateTime": "2024-01-01T00:00:00.000Z"
  }
}
```

### æœç´¢å“ç‰Œ
```javascript
// è¯·æ±‚
GET /api/brands?name=å°ç±³&status=1&page=1&limit=10
Authorization: Bearer <token>

// å“åº”
{
  "code": 200,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "items": [
      {
        "id": 1,
        "name": "å°ç±³",
        "iconUrl": "https://example.com/mi-logo.png",
        "status": 1,
        "isAuth": 0,
        "isHot": 0,
        "label": ["chinese", "tech"]
      }
    ],
    "meta": {
      "total": 1,
      "page": 1,
      "limit": 10,
      "totalPages": 1
    }
  }
}
```

## æµ‹è¯•

### è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test:brands

# æˆ–è€…ä½¿ç”¨æµ‹è¯•è„šæœ¬
node test-runner.js

# æˆ–è€…ç›´æ¥è¿è¡ŒAPIæµ‹è¯•
chmod +x test-brands-api.sh
./test-brands-api.sh
```

### æµ‹è¯•è¦†ç›–
- âœ… å“ç‰Œåˆ›å»ºæµ‹è¯•
- âœ… å“ç‰ŒæŸ¥è¯¢æµ‹è¯•
- âœ… å“ç‰Œæ›´æ–°æµ‹è¯•
- âœ… å“ç‰Œåˆ é™¤æµ‹è¯•
- âœ… æ‰¹é‡æ“ä½œæµ‹è¯•
- âœ… æƒé™éªŒè¯æµ‹è¯•
- âœ… é”™è¯¯å¤„ç†æµ‹è¯•

## éƒ¨ç½²è¯´æ˜

### æ•°æ®åº“è¿ç§»
```bash
# è¿è¡Œè¿ç§»
npm run migration:run

# å›æ»šè¿ç§»
npm run migration:revert
```

### ç¯å¢ƒå˜é‡
ç¡®ä¿åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®äº†å¿…è¦çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€‚

### æƒé™é…ç½®
åœ¨è§’è‰²ç®¡ç†ç³»ç»Ÿä¸­ä¸ºç›¸åº”çš„è§’è‰²åˆ†é…å“ç‰Œç®¡ç†æƒé™ã€‚

## æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-01-01)
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… å®Œæ•´çš„CRUDåŠŸèƒ½
- âœ… å¤šç§Ÿæˆ·æ”¯æŒ
- âœ… æ‰¹é‡æ“ä½œåŠŸèƒ½
- âœ… ç»Ÿè®¡åˆ†æåŠŸèƒ½
- âœ… å®Œæ•´çš„æƒé™æ§åˆ¶

## æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: NestJS
- **æ•°æ®åº“**: MySQL
- **ORM**: TypeORM
- **è¯­è¨€**: TypeScript
- **éªŒè¯**: class-validator
- **æ–‡æ¡£**: Swagger
- **æµ‹è¯•**: Jest

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚